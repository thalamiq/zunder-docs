{
  "openapi": "3.1.0",
  "info": {
    "title": "Zunder API",
    "description": "FHIR R4 RESTful API implementation. All endpoints are prefixed with `/fhir` and follow the FHIR specification.",
    "version": "1.0.0",
    "contact": {
      "name": "Zunder",
      "url": "https://github.com/thalamiq/zunder"
    },
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8080/fhir",
      "description": "Local development server (default port 8080)"
    },
    {
      "url": "https://your-server.com/fhir",
      "description": "Production server (replace with your actual server URL)"
    },
    {
      "url": "https://api.example.com/fhir",
      "description": "Example production server"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/metadata": {
      "get": {
        "summary": "Get Capability Statement",
        "description": "Retrieve the server's capability statement describing supported resources, operations, and search parameters.",
        "operationId": "getCapabilityStatement",
        "tags": ["Metadata"],
        "responses": {
          "200": {
            "description": "Capability statement",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/CapabilityStatement"
                }
              },
              "application/fhir+xml": {
                "schema": {
                  "$ref": "#/components/schemas/CapabilityStatement"
                }
              }
            }
          }
        }
      }
    },
    "/": {
      "get": {
        "summary": "System-Level Search",
        "description": "Search across all resource types in the system.",
        "operationId": "searchSystem",
        "tags": ["Search"],
        "parameters": [
          {
            "$ref": "#/components/parameters/Count"
          },
          {
            "$ref": "#/components/parameters/Sort"
          },
          {
            "$ref": "#/components/parameters/Summary"
          },
          {
            "$ref": "#/components/parameters/Total"
          },
          {
            "$ref": "#/components/parameters/Type"
          },
          {
            "$ref": "#/components/parameters/LastUpdated"
          }
        ],
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              },
              "application/fhir+xml": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "post": {
        "summary": "Batch or Transaction",
        "description": "Execute a batch or transaction operation. The Bundle type determines the behavior: 'batch' for independent operations, 'transaction' for atomic operations.",
        "operationId": "batchOrTransaction",
        "tags": ["Batch", "Transaction"],
        "requestBody": {
          "required": true,
          "content": {
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Bundle"
              }
            },
            "application/fhir+xml": {
              "schema": {
                "$ref": "#/components/schemas/Bundle"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Batch or transaction response",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              },
              "application/fhir+xml": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "delete": {
        "summary": "System Delete",
        "description": "Delete all resources in the system (use with caution).",
        "operationId": "systemDelete",
        "tags": ["CRUD"],
        "responses": {
          "200": {
            "description": "Deletion response",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationOutcome"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/_search": {
      "post": {
        "summary": "System-Level Search (POST)",
        "description": "Search across all resource types using POST method.",
        "operationId": "searchSystemPost",
        "tags": ["Search"],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/_history": {
      "get": {
        "summary": "System History",
        "description": "Get history of all resources in the system.",
        "operationId": "systemHistory",
        "tags": ["History"],
        "parameters": [
          {
            "$ref": "#/components/parameters/Count"
          },
          {
            "$ref": "#/components/parameters/Since"
          },
          {
            "$ref": "#/components/parameters/At"
          }
        ],
        "responses": {
          "200": {
            "description": "History bundle",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          }
        }
      }
    },
    "/${operation}": {
      "get": {
        "summary": "System-Level Operation (GET)",
        "description": "Execute a system-level FHIR operation using GET method.",
        "operationId": "systemOperationGet",
        "tags": ["Operations"],
        "parameters": [
          {
            "name": "operation",
            "in": "path",
            "required": true,
            "description": "The operation name (e.g., $validate, $export)",
            "schema": {
              "type": "string",
              "pattern": "^\\$[a-zA-Z][a-zA-Z0-9]*$"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Operation result",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Parameters"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "post": {
        "summary": "System-Level Operation (POST)",
        "description": "Execute a system-level FHIR operation using POST method.",
        "operationId": "systemOperationPost",
        "tags": ["Operations"],
        "parameters": [
          {
            "name": "operation",
            "in": "path",
            "required": true,
            "description": "The operation name (e.g., $validate, $export)",
            "schema": {
              "type": "string",
              "pattern": "^\\$[a-zA-Z][a-zA-Z0-9]*$"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Parameters"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation result",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Parameters"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/{resourceType}": {
      "get": {
        "summary": "Search Resources by Type",
        "description": "Search for resources of a specific type using search parameters.",
        "operationId": "searchType",
        "tags": ["Search"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Count"
          },
          {
            "$ref": "#/components/parameters/Sort"
          },
          {
            "$ref": "#/components/parameters/Summary"
          },
          {
            "$ref": "#/components/parameters/Total"
          },
          {
            "$ref": "#/components/parameters/LastUpdated"
          },
          {
            "$ref": "#/components/parameters/Id"
          }
        ],
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              },
              "application/fhir+xml": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "post": {
        "summary": "Create Resource",
        "description": "Create a new resource of the specified type. Supports conditional create using If-None-Exist header.",
        "operationId": "createResource",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          }
        ],
        "requestBody": {
          "required": true,
          "description": "The FHIR resource to create",
          "content": {
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Resource"
              }
            },
            "application/fhir+xml": {
              "schema": {
                "$ref": "#/components/schemas/Resource"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Resource created",
            "headers": {
              "Location": {
                "description": "URL of the created resource",
                "schema": {
                  "type": "string"
                }
              },
              "ETag": {
                "description": "Version identifier",
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "200": {
            "description": "Resource already exists (conditional create)",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "put": {
        "summary": "Conditional Update",
        "description": "Update a resource conditionally based on search parameters.",
        "operationId": "conditionalUpdate",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Resource"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Resource updated",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "201": {
            "description": "Resource created (update-create)",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "412": {
            "$ref": "#/components/responses/PreconditionFailed"
          }
        }
      },
      "patch": {
        "summary": "Conditional Patch",
        "description": "Partially update a resource conditionally based on search parameters.",
        "operationId": "conditionalPatch",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json-patch+json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/JsonPatchOperation"
                }
              }
            },
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Parameters"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Resource patched",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "delete": {
        "summary": "Conditional Delete",
        "description": "Delete resources conditionally based on search parameters.",
        "operationId": "conditionalDelete",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          }
        ],
        "responses": {
          "200": {
            "description": "Resources deleted",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationOutcome"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/{resourceType}/_search": {
      "post": {
        "summary": "Type-Level Search (POST)",
        "description": "Search resources of a specific type using POST method.",
        "operationId": "searchTypePost",
        "tags": ["Search"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/{resourceType}/_history": {
      "get": {
        "summary": "Type History",
        "description": "Get history of all resources of a specific type.",
        "operationId": "typeHistory",
        "tags": ["History"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Count"
          },
          {
            "$ref": "#/components/parameters/Since"
          },
          {
            "$ref": "#/components/parameters/At"
          }
        ],
        "responses": {
          "200": {
            "description": "History bundle",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          }
        }
      }
    },
    "/{resourceType}/${operation}": {
      "get": {
        "summary": "Type-Level Operation (GET)",
        "description": "Execute a type-level FHIR operation using GET method.",
        "operationId": "typeOperationGet",
        "tags": ["Operations"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "name": "operation",
            "in": "path",
            "required": true,
            "description": "The operation name (e.g., $validate, $everything)",
            "schema": {
              "type": "string",
              "pattern": "^\\$[a-zA-Z][a-zA-Z0-9]*$"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Operation result",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Parameters"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "post": {
        "summary": "Type-Level Operation (POST)",
        "description": "Execute a type-level FHIR operation using POST method.",
        "operationId": "typeOperationPost",
        "tags": ["Operations"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "name": "operation",
            "in": "path",
            "required": true,
            "description": "The operation name (e.g., $validate, $everything)",
            "schema": {
              "type": "string",
              "pattern": "^\\$[a-zA-Z][a-zA-Z0-9]*$"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Parameters"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation result",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Parameters"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/{resourceType}/{id}": {
      "get": {
        "summary": "Read Resource",
        "description": "Read a specific resource by type and ID.",
        "operationId": "readResource",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          },
          {
            "$ref": "#/components/parameters/IfNoneMatch"
          },
          {
            "$ref": "#/components/parameters/IfModifiedSince"
          }
        ],
        "responses": {
          "200": {
            "description": "Resource found",
            "headers": {
              "ETag": {
                "description": "Version identifier",
                "schema": {
                  "type": "string"
                }
              },
              "Last-Modified": {
                "description": "Last modification date",
                "schema": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            },
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              },
              "application/fhir+xml": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "304": {
            "description": "Resource not modified"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "head": {
        "summary": "Check Resource Existence",
        "description": "Check if a resource exists without retrieving its body.",
        "operationId": "headResource",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          }
        ],
        "responses": {
          "200": {
            "description": "Resource exists"
          },
          "404": {
            "description": "Resource not found"
          }
        }
      },
      "put": {
        "summary": "Update Resource",
        "description": "Update an existing resource. Requires the current version ID in meta.versionId.",
        "operationId": "updateResource",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          },
          {
            "$ref": "#/components/parameters/IfMatch"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Resource"
              }
            },
            "application/fhir+xml": {
              "schema": {
                "$ref": "#/components/schemas/Resource"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Resource updated",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "201": {
            "description": "Resource created (update-create)",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          },
          "409": {
            "$ref": "#/components/responses/Conflict"
          },
          "412": {
            "$ref": "#/components/responses/PreconditionFailed"
          }
        }
      },
      "patch": {
        "summary": "Patch Resource",
        "description": "Partially update a resource using JSON Patch or FHIR Patch.",
        "operationId": "patchResource",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json-patch+json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/JsonPatchOperation"
                }
              }
            },
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Parameters"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Resource patched",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "delete": {
        "summary": "Delete Resource",
        "description": "Delete a specific resource by type and ID.",
        "operationId": "deleteResource",
        "tags": ["CRUD"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          }
        ],
        "responses": {
          "200": {
            "description": "Resource deleted",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "204": {
            "description": "Resource deleted (no content)"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/{resourceType}/{id}/_history": {
      "get": {
        "summary": "Resource History",
        "description": "Get the complete history of a specific resource.",
        "operationId": "resourceHistory",
        "tags": ["History"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          },
          {
            "$ref": "#/components/parameters/Count"
          },
          {
            "$ref": "#/components/parameters/Since"
          },
          {
            "$ref": "#/components/parameters/At"
          }
        ],
        "responses": {
          "200": {
            "description": "History bundle",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete Resource History",
        "description": "Delete the history of a specific resource.",
        "operationId": "deleteResourceHistory",
        "tags": ["History"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          }
        ],
        "responses": {
          "200": {
            "description": "History deleted",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationOutcome"
                }
              }
            }
          }
        }
      }
    },
    "/{resourceType}/{id}/_history/{vid}": {
      "get": {
        "summary": "Versioned Read (vread)",
        "description": "Read a specific version of a resource.",
        "operationId": "vreadResource",
        "tags": ["History"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          },
          {
            "name": "vid",
            "in": "path",
            "required": true,
            "description": "The version ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Resource version",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Resource"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "head": {
        "summary": "Check Version Existence",
        "description": "Check if a specific version exists without retrieving its body.",
        "operationId": "headVreadResource",
        "tags": ["History"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          },
          {
            "name": "vid",
            "in": "path",
            "required": true,
            "description": "The version ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Version exists"
          },
          "404": {
            "description": "Version not found"
          }
        }
      },
      "delete": {
        "summary": "Delete Resource Version",
        "description": "Delete a specific version of a resource.",
        "operationId": "deleteResourceHistoryVersion",
        "tags": ["History"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          },
          {
            "name": "vid",
            "in": "path",
            "required": true,
            "description": "The version ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Version deleted",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/OperationOutcome"
                }
              }
            }
          }
        }
      }
    },
    "/{resourceType}/{id}/${operation}": {
      "get": {
        "summary": "Instance-Level Operation (GET)",
        "description": "Execute an instance-level FHIR operation using GET method.",
        "operationId": "instanceOperationGet",
        "tags": ["Operations"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          },
          {
            "name": "operation",
            "in": "path",
            "required": true,
            "description": "The operation name (e.g., $validate, $everything)",
            "schema": {
              "type": "string",
              "pattern": "^\\$[a-zA-Z][a-zA-Z0-9]*$"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Operation result",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Parameters"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "post": {
        "summary": "Instance-Level Operation (POST)",
        "description": "Execute an instance-level FHIR operation using POST method.",
        "operationId": "instanceOperationPost",
        "tags": ["Operations"],
        "parameters": [
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Id"
          },
          {
            "name": "operation",
            "in": "path",
            "required": true,
            "description": "The operation name (e.g., $validate, $everything)",
            "schema": {
              "type": "string",
              "pattern": "^\\$[a-zA-Z][a-zA-Z0-9]*$"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/fhir+json": {
              "schema": {
                "$ref": "#/components/schemas/Parameters"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation result",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Parameters"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/{compartmentType}/{compartmentId}/{resourceType}": {
      "get": {
        "summary": "Compartment Search",
        "description": "Search for resources within a compartment.",
        "operationId": "searchCompartment",
        "tags": ["Search"],
        "parameters": [
          {
            "name": "compartmentType",
            "in": "path",
            "required": true,
            "description": "The compartment type (Patient, Encounter, etc.)",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "compartmentId",
            "in": "path",
            "required": true,
            "description": "The compartment resource ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/ResourceType"
          },
          {
            "$ref": "#/components/parameters/Count"
          },
          {
            "$ref": "#/components/parameters/Sort"
          }
        ],
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/{compartmentType}/{compartmentId}/_search": {
      "post": {
        "summary": "Compartment Search (POST)",
        "description": "Search for resources within a compartment using POST method.",
        "operationId": "searchCompartmentPost",
        "tags": ["Search"],
        "parameters": [
          {
            "name": "compartmentType",
            "in": "path",
            "required": true,
            "description": "The compartment type (Patient, Encounter, etc.)",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "compartmentId",
            "in": "path",
            "required": true,
            "description": "The compartment resource ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/{compartmentType}/{compartmentId}/{resourceType}/_search": {
      "post": {
        "summary": "Compartment Search by Type (POST)",
        "description": "Search for resources of a specific type within a compartment using POST method.",
        "operationId": "searchCompartmentTypePost",
        "tags": ["Search"],
        "parameters": [
          {
            "name": "compartmentType",
            "in": "path",
            "required": true,
            "description": "The compartment type (Patient, Encounter, etc.)",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "compartmentId",
            "in": "path",
            "required": true,
            "description": "The compartment resource ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/ResourceType"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/fhir+json": {
                "schema": {
                  "$ref": "#/components/schemas/Bundle"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Resource": {
        "type": "object",
        "description": "A FHIR resource. All resources have resourceType, id, and meta fields.",
        "required": ["resourceType"],
        "properties": {
          "resourceType": {
            "type": "string",
            "description": "The type of resource"
          },
          "id": {
            "type": "string",
            "description": "Logical id of this artifact"
          },
          "meta": {
            "$ref": "#/components/schemas/Meta"
          }
        },
        "additionalProperties": true
      },
      "Meta": {
        "type": "object",
        "description": "Metadata about a resource",
        "properties": {
          "versionId": {
            "type": "string",
            "description": "Version specific identifier"
          },
          "lastUpdated": {
            "type": "string",
            "format": "date-time",
            "description": "When the resource version last changed"
          },
          "profile": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uri"
            },
            "description": "Profiles this resource claims to conform to"
          },
          "tag": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Coding"
            },
            "description": "Tags applied to this resource"
          },
          "security": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Coding"
            },
            "description": "Security labels applied to this resource"
          }
        }
      },
      "Coding": {
        "type": "object",
        "description": "A reference to a code defined by a terminology system",
        "properties": {
          "system": {
            "type": "string",
            "format": "uri",
            "description": "Identity of the terminology system"
          },
          "version": {
            "type": "string",
            "description": "Version of the system - if relevant"
          },
          "code": {
            "type": "string",
            "description": "Symbol in syntax defined by the system"
          },
          "display": {
            "type": "string",
            "description": "Representation defined by the system"
          }
        }
      },
      "Bundle": {
        "type": "object",
        "description": "A container for a collection of resources",
        "required": ["resourceType", "type"],
        "properties": {
          "resourceType": {
            "type": "string",
            "enum": ["Bundle"],
            "description": "Resource type"
          },
          "type": {
            "type": "string",
            "enum": [
              "document",
              "message",
              "transaction",
              "transaction-response",
              "batch",
              "batch-response",
              "history",
              "searchset",
              "collection"
            ],
            "description": "Indicates the purpose of this bundle"
          },
          "total": {
            "type": "integer",
            "description": "If search, the total number of matches"
          },
          "link": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BundleLink"
            },
            "description": "Links related to this Bundle"
          },
          "entry": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BundleEntry"
            },
            "description": "Entry in the bundle"
          }
        }
      },
      "BundleLink": {
        "type": "object",
        "description": "A link to another resource",
        "properties": {
          "relation": {
            "type": "string",
            "description": "See http://www.iana.org/assignments/link-relations/link-relations.xhtml#link-relations-1"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "Reference details for the link"
          }
        }
      },
      "BundleEntry": {
        "type": "object",
        "description": "An entry in a bundle resource",
        "properties": {
          "fullUrl": {
            "type": "string",
            "format": "uri",
            "description": "URI for resource"
          },
          "resource": {
            "$ref": "#/components/schemas/Resource"
          },
          "request": {
            "$ref": "#/components/schemas/BundleEntryRequest"
          },
          "response": {
            "$ref": "#/components/schemas/BundleEntryResponse"
          }
        }
      },
      "BundleEntryRequest": {
        "type": "object",
        "description": "Additional information about how this entry should be processed",
        "properties": {
          "method": {
            "type": "string",
            "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"],
            "description": "HTTP verb for the operation"
          },
          "url": {
            "type": "string",
            "description": "URL for HTTP equivalent of this entry"
          }
        }
      },
      "BundleEntryResponse": {
        "type": "object",
        "description": "Indicates the results of processing the corresponding 'request' entry",
        "properties": {
          "status": {
            "type": "string",
            "description": "Status response code"
          },
          "location": {
            "type": "string",
            "description": "The location (if the operation returns a location)"
          },
          "etag": {
            "type": "string",
            "description": "The etag for the resource (if relevant)"
          },
          "lastModified": {
            "type": "string",
            "format": "date-time",
            "description": "Server's date time modified"
          },
          "outcome": {
            "$ref": "#/components/schemas/OperationOutcome"
          }
        }
      },
      "OperationOutcome": {
        "type": "object",
        "description": "A collection of error, warning or information messages that result from a system action",
        "required": ["resourceType"],
        "properties": {
          "resourceType": {
            "type": "string",
            "enum": ["OperationOutcome"],
            "description": "Resource type"
          },
          "issue": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OperationOutcomeIssue"
            },
            "description": "A list of issues associated with the operation"
          }
        }
      },
      "OperationOutcomeIssue": {
        "type": "object",
        "description": "An issue associated with the operation",
        "required": ["severity", "code"],
        "properties": {
          "severity": {
            "type": "string",
            "enum": ["fatal", "error", "warning", "information"],
            "description": "Severity of the issue"
          },
          "code": {
            "type": "string",
            "enum": [
              "invalid",
              "structure",
              "required",
              "value",
              "invariant",
              "security",
              "login",
              "unknown",
              "expired",
              "forbidden",
              "suppressed",
              "processing",
              "not-supported",
              "duplicate",
              "multiple-matches",
              "not-found",
              "deleted",
              "too-long",
              "code-invalid",
              "extension",
              "too-costly",
              "business-rule",
              "conflict",
              "transient",
              "lock-error",
              "no-store",
              "exception",
              "timeout",
              "incomplete",
              "throttled",
              "informational"
            ],
            "description": "Error or warning code"
          },
          "details": {
            "$ref": "#/components/schemas/CodeableConcept"
          },
          "diagnostics": {
            "type": "string",
            "description": "Additional diagnostic information about the issue"
          },
          "location": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "XPath or JSONPath expression describing the location of the issue"
          }
        }
      },
      "CodeableConcept": {
        "type": "object",
        "description": "A concept that may be defined by a formal reference to a terminology or ontology",
        "properties": {
          "coding": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Coding"
            }
          },
          "text": {
            "type": "string",
            "description": "Plain text representation of the concept"
          }
        }
      },
      "CapabilityStatement": {
        "type": "object",
        "description": "A Capability Statement documents a set of capabilities (behaviors) of a FHIR Server",
        "required": ["resourceType"],
        "properties": {
          "resourceType": {
            "type": "string",
            "enum": ["CapabilityStatement"]
          },
          "status": {
            "type": "string",
            "enum": ["draft", "active", "retired", "unknown"]
          },
          "date": {
            "type": "string",
            "format": "date-time"
          },
          "kind": {
            "type": "string",
            "enum": ["instance", "capability", "requirements"]
          },
          "software": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "version": {
                "type": "string"
              }
            }
          },
          "fhirVersion": {
            "type": "string"
          },
          "format": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "rest": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        }
      },
      "Parameters": {
        "type": "object",
        "description": "This resource is a non-persisted resource used to pass information into and back from an operation",
        "required": ["resourceType"],
        "properties": {
          "resourceType": {
            "type": "string",
            "enum": ["Parameters"]
          },
          "parameter": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ParametersParameter"
            }
          }
        }
      },
      "ParametersParameter": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "valueString": {
            "type": "string"
          },
          "valueBoolean": {
            "type": "boolean"
          },
          "valueInteger": {
            "type": "integer"
          },
          "valueDecimal": {
            "type": "number"
          },
          "valueUri": {
            "type": "string",
            "format": "uri"
          },
          "valueDateTime": {
            "type": "string",
            "format": "date-time"
          },
          "valueResource": {
            "$ref": "#/components/schemas/Resource"
          },
          "part": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ParametersParameter"
            }
          }
        }
      },
      "JsonPatchOperation": {
        "type": "object",
        "description": "A JSON Patch operation (RFC 6902)",
        "required": ["op", "path"],
        "properties": {
          "op": {
            "type": "string",
            "enum": ["add", "remove", "replace", "move", "copy", "test"],
            "description": "The operation to perform"
          },
          "path": {
            "type": "string",
            "description": "A JSON Pointer path"
          },
          "value": {
            "description": "The value to use"
          },
          "from": {
            "type": "string",
            "description": "A JSON Pointer path (for move/copy operations)"
          }
        }
      }
    },
    "parameters": {
      "ResourceType": {
        "name": "resourceType",
        "in": "path",
        "required": true,
        "description": "The FHIR resource type (e.g., Patient, Observation, Encounter)",
        "schema": {
          "type": "string"
        }
      },
      "Id": {
        "name": "id",
        "in": "path",
        "required": true,
        "description": "The logical ID of the resource",
        "schema": {
          "type": "string"
        }
      },
      "Count": {
        "name": "_count",
        "in": "query",
        "description": "Maximum number of results to return",
        "schema": {
          "type": "integer",
          "minimum": 0,
          "default": 10
        }
      },
      "Sort": {
        "name": "_sort",
        "in": "query",
        "description": "Sort order (prefix with - for descending)",
        "schema": {
          "type": "string"
        }
      },
      "Summary": {
        "name": "_summary",
        "in": "query",
        "description": "Summary mode",
        "schema": {
          "type": "string",
          "enum": ["true", "text", "data", "count"]
        }
      },
      "Total": {
        "name": "_total",
        "in": "query",
        "description": "Include total count",
        "schema": {
          "type": "string",
          "enum": ["none", "estimate", "accurate"]
        }
      },
      "Type": {
        "name": "_type",
        "in": "query",
        "description": "Filter by resource types (comma-separated)",
        "schema": {
          "type": "string"
        }
      },
      "LastUpdated": {
        "name": "_lastUpdated",
        "in": "query",
        "description": "Filter by last updated date",
        "schema": {
          "type": "string"
        }
      },
      "Since": {
        "name": "_since",
        "in": "query",
        "description": "Only return resources modified since this date/time",
        "schema": {
          "type": "string",
          "format": "date-time"
        }
      },
      "At": {
        "name": "_at",
        "in": "query",
        "description": "Return resources as they were at a specific point in time",
        "schema": {
          "type": "string",
          "format": "date-time"
        }
      },
      "IfMatch": {
        "name": "If-Match",
        "in": "header",
        "description": "For version-aware updates",
        "schema": {
          "type": "string"
        }
      },
      "IfNoneMatch": {
        "name": "If-None-Match",
        "in": "header",
        "description": "For conditional reads (304 Not Modified)",
        "schema": {
          "type": "string"
        }
      },
      "IfModifiedSince": {
        "name": "If-Modified-Since",
        "in": "header",
        "description": "For conditional reads (304 Not Modified)",
        "schema": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "Bad request - validation error or invalid input",
        "content": {
          "application/fhir+json": {
            "schema": {
              "$ref": "#/components/schemas/OperationOutcome"
            }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/fhir+json": {
            "schema": {
              "$ref": "#/components/schemas/OperationOutcome"
            }
          }
        }
      },
      "Conflict": {
        "description": "Version conflict",
        "content": {
          "application/fhir+json": {
            "schema": {
              "$ref": "#/components/schemas/OperationOutcome"
            }
          }
        }
      },
      "PreconditionFailed": {
        "description": "Precondition failed",
        "content": {
          "application/fhir+json": {
            "schema": {
              "$ref": "#/components/schemas/OperationOutcome"
            }
          }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Bearer token authentication"
      }
    }
  }
}
